version: "0.1"
name: "Customer Support Automation"
description: "An intelligent customer support workflow that categorizes, analyzes, and responds to customer inquiries"
agents:
  ticket_classifier:
    model: "gpt-4"
    provider: "openai"
    prompt: "Classify this customer inquiry: {{input}}. Categorize by: product area, urgency level (low/medium/high/critical), sentiment (positive/neutral/negative), and complexity (simple/moderate/complex). Provide brief reasoning."
    parameters:
      temperature: 0.2
      max_tokens: 300

  sentiment_analyzer:
    model: "claude-3-haiku-20240307"
    provider: "anthropic"
    prompt: "Analyze the sentiment and emotional state of this customer message: {{input}}. Rate frustration level (1-10), identify key emotions, and suggest appropriate response tone."
    parameters:
      temperature: 0.3
      max_tokens: 400

  knowledge_retriever:
    model: "gpt-4"
    provider: "openai"
    prompt: "Based on this customer issue: {{input}} and classification: {{ticket_classifier.output}}, retrieve and summarize relevant knowledge base articles, FAQs, and troubleshooting steps. Focus on the most relevant information."
    parameters:
      temperature: 0.2
      max_tokens: 800

  response_drafter:
    model: "claude-3-sonnet-20240229"
    provider: "anthropic"
    prompt: "Draft a customer response based on: Classification: {{ticket_classifier.output}}, Sentiment: {{sentiment_analyzer.output}}, Knowledge: {{knowledge_retriever.output}}. Original inquiry: {{input}}. Make it empathetic, helpful, and professional."
    parameters:
      temperature: 0.6
      max_tokens: 1000

  escalation_checker:
    model: "gpt-4"
    provider: "openai"
    prompt: "Review this customer case and determine if it needs escalation. Case details: {{input}}, Classification: {{ticket_classifier.output}}, Sentiment: {{sentiment_analyzer.output}}. Consider: complexity, impact, customer value, and resolution capability."
    parameters:
      temperature: 0.3
      max_tokens: 300

  follow_up_planner:
    model: "claude-3-haiku-20240307"
    provider: "anthropic"
    prompt: "Plan follow-up actions for this customer case. Response: {{response_drafter.output}}, Escalation decision: {{escalation_checker.output}}. Suggest next steps, timelines, and any additional support needed."
    parameters:
      temperature: 0.4
      max_tokens: 500

workflow:
  - type: agent
    step: "classify_ticket"
    agent: "ticket_classifier"
    save: "ticket_classification"

  - type: agent
    step: "analyze_sentiment"
    agent: "sentiment_analyzer"
    save: "sentiment_analysis"

  - type: agent
    step: "retrieve_knowledge"
    agent: "knowledge_retriever"
    save: "relevant_knowledge"

  - type: agent
    step: "check_escalation"
    agent: "escalation_checker"
    save: "escalation_decision"

  - type: conditional
    step: "escalation_gate"
    if: "{{escalation_decision | regex_search(r'Decision: (\\w+)') | lower == 'escalate'}}"
    then:
      - type: agent
        step: "draft_escalation_response"
        agent: "response_drafter"
        context: "This case requires escalation to a human agent. Draft a response acknowledging the issue and explaining next steps."
        save: "customer_response"
      - type: agent
        step: "plan_follow_up"
        agent: "follow_up_planner"
        context: "This is an escalated case that needs human intervention."
        save: "follow_up_plan"
    else:
      - type: agent
        step: "draft_response"
        agent: "response_drafter"
        save: "customer_response"
      - type: agent
        step: "plan_follow_up"
        agent: "follow_up_planner"
        save: "follow_up_plan"